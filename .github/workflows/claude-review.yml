name: Claude Code Review

on:
  # PR ìƒì„±/ì—…ë°ì´íŠ¸ ì‹œ ìë™ ë¦¬ë·°
  pull_request:
    types: [opened, synchronize, reopened]

  # PR ëŒ“ê¸€ì—ì„œ @claude ë©˜ì…˜ ì‹œ on-demand ë¦¬ë·°
  issue_comment:
    types: [created]
  pull_request_review_comment:
    types: [created]

jobs:
  # â”€â”€ ìë™ ë¦¬ë·°: PRì´ ì—´ë¦¬ê±°ë‚˜ ì»¤ë°‹ì´ ì¶”ê°€ë  ë•Œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  auto-review:
    if: github.event_name == 'pull_request'
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
      issues: write
    steps:
      - uses: actions/checkout@v4

      - uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          claude_args: "--max-turns 5"
          prompt: |
            ì´ PRì„ ì•„ë˜ ê´€ì ì—ì„œ í•œêµ­ì–´ë¡œ ì½”ë“œë¦¬ë·° í•´ì¤˜.

            ## í”„ë¡œì íŠ¸ ì»¨í…ìŠ¤íŠ¸
            - Java 17 + Spring Boot 3.2 ê¸°ë°˜ ë³‘ì› ì˜ˆì•½ API
            - ë ˆì´ì–´: Controller â†’ Service â†’ Repository (JPA)
            - ì—ëŸ¬ ì²˜ë¦¬: GlobalExceptionHandler (IllegalArgumentException=404, IllegalStateException=409)
            - DTO ë³€í™˜: ì •ì  íŒ©í† ë¦¬ ë©”ì„œë“œ `Response.from(entity)` íŒ¨í„´ ì‚¬ìš©

            ## ë¦¬ë·° ì²´í¬ë¦¬ìŠ¤íŠ¸
            1. **ë²„ê·¸ ë° ë¡œì§ ì˜¤ë¥˜**: ì˜ˆì•½ ìƒíƒœ ì „í™˜, null ì²˜ë¦¬, ê²½ê³„ ì¡°ê±´
            2. **ë³´ì•ˆ**: SQL Injection, ì…ë ¥ê°’ ê²€ì¦ ëˆ„ë½, ë¯¼ê° ì •ë³´ ë…¸ì¶œ
            3. **ë ˆì´ì–´ ë¶„ë¦¬**: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ Controllerì— ìˆì§€ ì•Šì€ì§€
            4. **íŠ¸ëœì­ì…˜**: ì“°ê¸° ì‘ì—…ì— @Transactional ëˆ„ë½ ì—¬ë¶€
            5. **ì½”ë“œ í’ˆì§ˆ**: ì¤‘ë³µ ì½”ë“œ, ê°€ë…ì„±, ë„¤ì´ë° ì»¨ë²¤ì…˜
            6. **í™•ì¥ì„±**: êµ¿ë‹¥ ì„œë¹„ìŠ¤ í™•ì¥(ë³‘ì›/ì˜ì‚¬ ë„ë©”ì¸, ì¸ì¦) ê´€ì ì—ì„œ ì„¤ê³„ ë¬¸ì œ

            ## ì¶œë ¥ í˜•ì‹
            - ì‹¬ê°ë„ë³„ë¡œ êµ¬ë¶„: ğŸ”´ í•„ìˆ˜ ìˆ˜ì • / ğŸŸ¡ ê°œì„  ê¶Œì¥ / ğŸŸ¢ ì¢‹ì€ ì 
            - ê° í•­ëª©ì— íŒŒì¼ëª…ê³¼ ë¼ì¸ ë²ˆí˜¸ í¬í•¨
            - ìˆ˜ì •ì´ í•„ìš”í•œ ê²½ìš° ìˆ˜ì • ì˜ˆì‹œ ì½”ë“œ ì œì‹œ

  # â”€â”€ On-demand ë¦¬ë·°: ëŒ“ê¸€ì—ì„œ @claude ë©˜ì…˜ ì‹œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  on-demand-review:
    if: |
      (github.event_name == 'issue_comment' && contains(github.event.comment.body, '@claude')) ||
      (github.event_name == 'pull_request_review_comment' && contains(github.event.comment.body, '@claude'))
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
      issues: write
    steps:
      - uses: actions/checkout@v4

      - uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          trigger_phrase: "@claude"
          claude_args: "--max-turns 10"
